/**
 * Sri Lanka Location Database
 * Comprehensive mapping of Sri Lankan cities, towns, and areas to coordinates
 */

export const sriLankaLocations = {
  // Colombo District
  "colombo": { lat: 6.9271, lng: 79.8612, district: "Colombo", province: "Western Province", postalCode: "00100" },
  "colombo 1": { lat: 6.9355, lng: 79.8509, district: "Colombo", province: "Western Province", postalCode: "00100" },
  "colombo 2": { lat: 6.9319, lng: 79.8478, district: "Colombo", province: "Western Province", postalCode: "00200" },
  "colombo 3": { lat: 6.9147, lng: 79.8501, district: "Colombo", province: "Western Province", postalCode: "00300" },
  "colombo 4": { lat: 6.8905, lng: 79.8561, district: "Colombo", province: "Western Province", postalCode: "00400" },
  "colombo 5": { lat: 6.8867, lng: 79.8821, district: "Colombo", province: "Western Province", postalCode: "00500" },
  "colombo 6": { lat: 6.8939, lng: 79.8611, district: "Colombo", province: "Western Province", postalCode: "00600" },
  "colombo 7": { lat: 6.9147, lng: 79.8750, district: "Colombo", province: "Western Province", postalCode: "00700" },
  "colombo 8": { lat: 6.9097, lng: 79.8746, district: "Colombo", province: "Western Province", postalCode: "00800" },
  "colombo 9": { lat: 6.8883, lng: 79.8708, district: "Colombo", province: "Western Province", postalCode: "00900" },
  "colombo 10": { lat: 6.9437, lng: 79.8972, district: "Colombo", province: "Western Province", postalCode: "01000" },
  "colombo 11": { lat: 6.9591, lng: 79.8810, district: "Colombo", province: "Western Province", postalCode: "01100" },
  "colombo 12": { lat: 6.9391, lng: 79.8793, district: "Colombo", province: "Western Province", postalCode: "01200" },
  "colombo 13": { lat: 6.9756, lng: 79.9205, district: "Colombo", province: "Western Province", postalCode: "01300" },
  "colombo 14": { lat: 6.9570, lng: 79.8862, district: "Colombo", province: "Western Province", postalCode: "01400" },
  "colombo 15": { lat: 6.9541, lng: 79.8974, district: "Colombo", province: "Western Province", postalCode: "01500" },

  "fort": { lat: 6.9355, lng: 79.8509, district: "Colombo", province: "Western Province", postalCode: "00100" },
  "pettah": { lat: 6.9368, lng: 79.8533, district: "Colombo", province: "Western Province", postalCode: "01100" },
  "colpetty": { lat: 6.9147, lng: 79.8501, district: "Colombo", province: "Western Province", postalCode: "00300" },
  "kollupitiya": { lat: 6.9147, lng: 79.8501, district: "Colombo", province: "Western Province", postalCode: "00300" },
  "bambalapitiya": { lat: 6.8905, lng: 79.8561, district: "Colombo", province: "Western Province", postalCode: "00400" },
  "wellawatte": { lat: 6.8728, lng: 79.8593, district: "Colombo", province: "Western Province", postalCode: "00600" },
  "wellawatta": { lat: 6.8728, lng: 79.8593, district: "Colombo", province: "Western Province", postalCode: "00600" },
  "dehiwala": { lat: 6.8515, lng: 79.8650, district: "Colombo", province: "Western Province", postalCode: "10350" },
  "mount lavinia": { lat: 6.8380, lng: 79.8637, district: "Colombo", province: "Western Province", postalCode: "10370" },
  "ratmalana": { lat: 6.8214, lng: 79.8862, district: "Colombo", province: "Western Province", postalCode: "10390" },
  "moratuwa": { lat: 6.7730, lng: 79.8816, district: "Colombo", province: "Western Province", postalCode: "10400" },
  "cinnamon gardens": { lat: 6.9147, lng: 79.8750, district: "Colombo", province: "Western Province", postalCode: "00700" },
  "borella": { lat: 6.9183, lng: 79.8794, district: "Colombo", province: "Western Province", postalCode: "00800" },
  "maradana": { lat: 6.9301, lng: 79.8631, district: "Colombo", province: "Western Province", postalCode: "01000" },
  "slave island": { lat: 6.9264, lng: 79.8551, district: "Colombo", province: "Western Province", postalCode: "00200" },
  "havelock town": { lat: 6.8939, lng: 79.8611, district: "Colombo", province: "Western Province", postalCode: "00500" },
  "nugegoda": { lat: 6.8649, lng: 79.8997, district: "Colombo", province: "Western Province", postalCode: "10250" },
  "kotte": { lat: 6.8905, lng: 79.9018, district: "Colombo", province: "Western Province", postalCode: "10100" },
  "sri jayawardenepura kotte": { lat: 6.8905, lng: 79.9018, district: "Colombo", province: "Western Province", postalCode: "10100" },
  "rajagiriya": { lat: 6.9078, lng: 79.8913, district: "Colombo", province: "Western Province", postalCode: "10107" },
  "battaramulla": { lat: 6.8993, lng: 79.9181, district: "Colombo", province: "Western Province", postalCode: "10120" },
  "maharagama": { lat: 6.8484, lng: 79.9265, district: "Colombo", province: "Western Province", postalCode: "10280" },
  "kaduwela": { lat: 6.9333, lng: 79.9833, district: "Colombo", province: "Western Province", postalCode: "10640" },
  "homagama": { lat: 6.8444, lng: 80.0025, district: "Colombo", province: "Western Province", postalCode: "10200" },
  "kottawa": { lat: 6.8230, lng: 79.9608, district: "Colombo", province: "Western Province", postalCode: "10230" },
  "piliyandala": { lat: 6.8011, lng: 79.9238, district: "Colombo", province: "Western Province", postalCode: "10300" },
  "kesbewa": { lat: 6.7833, lng: 79.9333, district: "Colombo", province: "Western Province" },

  // Gampaha District
  "gampaha": { lat: 7.0917, lng: 79.9999, district: "Gampaha", province: "Western Province", postalCode: "11000" },
  "negombo": { lat: 7.2094, lng: 79.8356, district: "Gampaha", province: "Western Province", postalCode: "11500" },
  "katunayake": { lat: 7.1697, lng: 79.8841, district: "Gampaha", province: "Western Province", postalCode: "11450" },
  "ja-ela": { lat: 7.0747, lng: 79.8919, district: "Gampaha", province: "Western Province" },
  "wattala": { lat: 6.9889, lng: 79.8917, district: "Gampaha", province: "Western Province" },
  "kelaniya": { lat: 6.9553, lng: 79.9219, district: "Gampaha", province: "Western Province" },
  "peliyagoda": { lat: 6.9681, lng: 79.8833, district: "Gampaha", province: "Western Province" },
  "kadawatha": { lat: 7.0092, lng: 79.9533, district: "Gampaha", province: "Western Province" },
  "ragama": { lat: 7.0281, lng: 79.9217, district: "Gampaha", province: "Western Province" },
  "kiribathgoda": { lat: 6.9808, lng: 79.9292, district: "Gampaha", province: "Western Province" },
  "veyangoda": { lat: 7.1511, lng: 80.0583, district: "Gampaha", province: "Western Province" },
  "minuwangoda": { lat: 7.1667, lng: 79.9500, district: "Gampaha", province: "Western Province" },
  "divulapitiya": { lat: 7.2167, lng: 80.0000, district: "Gampaha", province: "Western Province" },

  // Kalutara District
  "kalutara": { lat: 6.5854, lng: 79.9607, district: "Kalutara", province: "Western Province" },
  "panadura": { lat: 6.7133, lng: 79.9025, district: "Kalutara", province: "Western Province" },
  "horana": { lat: 6.7156, lng: 80.0628, district: "Kalutara", province: "Western Province" },
  "beruwala": { lat: 6.4789, lng: 79.9828, district: "Kalutara", province: "Western Province" },
  "aluthgama": { lat: 6.4275, lng: 79.9975, district: "Kalutara", province: "Western Province" },
  "wadduwa": { lat: 6.6667, lng: 79.9333, district: "Kalutara", province: "Western Province" },
  "matugama": { lat: 6.5250, lng: 80.1611, district: "Kalutara", province: "Western Province" },

  // Kandy District
  "kandy": { lat: 7.2906, lng: 80.6337, district: "Kandy", province: "Central Province", postalCode: "20000" },
  "peradeniya": { lat: 7.2571, lng: 80.5967, district: "Kandy", province: "Central Province", postalCode: "20400" },
  "katugastota": { lat: 7.3167, lng: 80.6333, district: "Kandy", province: "Central Province" },
  "gampola": { lat: 7.1644, lng: 80.5769, district: "Kandy", province: "Central Province" },
  "nawalapitiya": { lat: 7.0558, lng: 80.5394, district: "Kandy", province: "Central Province" },
  "kundasale": { lat: 7.2972, lng: 80.6794, district: "Kandy", province: "Central Province" },
  "akurana": { lat: 7.3667, lng: 80.6167, district: "Kandy", province: "Central Province" },
  "teldeniya": { lat: 7.3028, lng: 80.8117, district: "Kandy", province: "Central Province" },

  // Matale District
  "matale": { lat: 7.4675, lng: 80.6234, district: "Matale", province: "Central Province" },
  "dambulla": { lat: 7.8731, lng: 80.6514, district: "Matale", province: "Central Province" },
  "galewela": { lat: 7.7500, lng: 80.5667, district: "Matale", province: "Central Province" },
  "sigiriya": { lat: 7.9569, lng: 80.7603, district: "Matale", province: "Central Province" },

  // Nuwara Eliya District
  "nuwara eliya": { lat: 6.9497, lng: 80.7891, district: "Nuwara Eliya", province: "Central Province" },
  "hatton": { lat: 6.8917, lng: 80.5972, district: "Nuwara Eliya", province: "Central Province" },
  "talawakele": { lat: 6.9397, lng: 80.6594, district: "Nuwara Eliya", province: "Central Province" },
  "nanuoya": { lat: 6.9442, lng: 80.7617, district: "Nuwara Eliya", province: "Central Province" },

  // Galle District
  "galle": { lat: 6.0535, lng: 80.2210, district: "Galle", province: "Southern Province", postalCode: "80000" },
  "hikkaduwa": { lat: 6.1408, lng: 80.1036, district: "Galle", province: "Southern Province" },
  "ambalangoda": { lat: 6.2358, lng: 80.0536, district: "Galle", province: "Southern Province" },
  "bentota": { lat: 6.4258, lng: 79.9956, district: "Galle", province: "Southern Province" },
  "unawatuna": { lat: 6.0100, lng: 80.2489, district: "Galle", province: "Southern Province" },
  "koggala": { lat: 5.9942, lng: 80.3281, district: "Galle", province: "Southern Province" },
  "ahangama": { lat: 5.9731, lng: 80.3608, district: "Galle", province: "Southern Province" },

  // Matara District
  "matara": { lat: 5.9549, lng: 80.5550, district: "Matara", province: "Southern Province" },
  "weligama": { lat: 5.9736, lng: 80.4297, district: "Matara", province: "Southern Province" },
  "mirissa": { lat: 5.9467, lng: 80.4553, district: "Matara", province: "Southern Province" },
  "dikwella": { lat: 5.9667, lng: 80.6833, district: "Matara", province: "Southern Province" },

  // Hambantota District
  "hambantota": { lat: 6.1429, lng: 81.1212, district: "Hambantota", province: "Southern Province" },
  "tangalle": { lat: 6.0236, lng: 80.7975, district: "Hambantota", province: "Southern Province" },
  "tissamaharama": { lat: 6.2833, lng: 81.2833, district: "Hambantota", province: "Southern Province" },

  // Jaffna District
  "jaffna": { lat: 9.6615, lng: 80.0255, district: "Jaffna", province: "Northern Province", postalCode: "40000" },
  "jaffna city": { lat: 9.6615, lng: 80.0255, district: "Jaffna", province: "Northern Province", postalCode: "40000" },
  "nallur": { lat: 9.6833, lng: 80.0333, district: "Jaffna", province: "Northern Province" },
  "chavakachcheri": { lat: 9.6667, lng: 80.1667, district: "Jaffna", province: "Northern Province" },
  "point pedro": { lat: 9.8167, lng: 80.2333, district: "Jaffna", province: "Northern Province" },

  // Kilinochchi District
  "kilinochchi": { lat: 9.3833, lng: 80.4000, district: "Kilinochchi", province: "Northern Province" },

  // Mannar District
  "mannar": { lat: 8.9811, lng: 79.9044, district: "Mannar", province: "Northern Province" },

  // Vavuniya District
  "vavuniya": { lat: 8.7542, lng: 80.4982, district: "Vavuniya", province: "Northern Province" },

  // Mullaitivu District
  "mullaitivu": { lat: 9.2672, lng: 80.8142, district: "Mullaitivu", province: "Northern Province" },

  // Batticaloa District
  "batticaloa": { lat: 7.7310, lng: 81.6747, district: "Batticaloa", province: "Eastern Province" },
  "kattankudy": { lat: 7.6833, lng: 81.7333, district: "Batticaloa", province: "Eastern Province" },

  // Ampara District
  "ampara": { lat: 7.2972, lng: 81.6681, district: "Ampara", province: "Eastern Province" },
  "kalmunai": { lat: 7.4167, lng: 81.8333, district: "Ampara", province: "Eastern Province" },
  "akkaraipattu": { lat: 7.2167, lng: 81.8500, district: "Ampara", province: "Eastern Province" },

  // Trincomalee District
  "trincomalee": { lat: 8.5874, lng: 81.2152, district: "Trincomalee", province: "Eastern Province" },
  "nilaveli": { lat: 8.7000, lng: 81.1833, district: "Trincomalee", province: "Eastern Province" },
  "kinniya": { lat: 8.5000, lng: 81.1833, district: "Trincomalee", province: "Eastern Province" },

  // Kurunegala District
  "kurunegala": { lat: 7.4863, lng: 80.3623, district: "Kurunegala", province: "North Western Province" },
  "kuliyapitiya": { lat: 7.4689, lng: 80.0403, district: "Kurunegala", province: "North Western Province" },
  "wariyapola": { lat: 7.5167, lng: 80.2000, district: "Kurunegala", province: "North Western Province" },
  "narammala": { lat: 7.4333, lng: 80.2000, district: "Kurunegala", province: "North Western Province" },

  // Puttalam District
  "puttalam": { lat: 8.0406, lng: 79.8283, district: "Puttalam", province: "North Western Province" },
  "chilaw": { lat: 7.5756, lng: 79.7953, district: "Puttalam", province: "North Western Province" },
  "wennappuwa": { lat: 7.3500, lng: 79.8500, district: "Puttalam", province: "North Western Province" },

  // Anuradhapura District
  "anuradhapura": { lat: 8.3114, lng: 80.4037, district: "Anuradhapura", province: "North Central Province" },
  "mihintale": { lat: 8.3508, lng: 80.5028, district: "Anuradhapura", province: "North Central Province" },
  "kekirawa": { lat: 8.0333, lng: 80.6000, district: "Anuradhapura", province: "North Central Province" },

  // Polonnaruwa District
  "polonnaruwa": { lat: 7.9403, lng: 81.0188, district: "Polonnaruwa", province: "North Central Province" },
  "hingurakgoda": { lat: 8.0333, lng: 80.9667, district: "Polonnaruwa", province: "North Central Province" },
  "medirigiriya": { lat: 8.0167, lng: 80.9167, district: "Polonnaruwa", province: "North Central Province" },

  // Badulla District
  "badulla": { lat: 6.9934, lng: 81.0550, district: "Badulla", province: "Uva Province" },
  "bandarawela": { lat: 6.8333, lng: 80.9833, district: "Badulla", province: "Uva Province" },
  "haputale": { lat: 6.7667, lng: 80.9500, district: "Badulla", province: "Uva Province" },
  "ella": { lat: 6.8667, lng: 81.0500, district: "Badulla", province: "Uva Province" },
  "welimada": { lat: 6.9000, lng: 80.9167, district: "Badulla", province: "Uva Province" },

  // Monaragala District
  "monaragala": { lat: 6.8728, lng: 81.3506, district: "Monaragala", province: "Uva Province" },
  "wellawaya": { lat: 6.7333, lng: 81.1000, district: "Monaragala", province: "Uva Province" },
  "bibile": { lat: 7.1667, lng: 81.2000, district: "Monaragala", province: "Uva Province" },

  // Ratnapura District
  "ratnapura": { lat: 6.6828, lng: 80.4017, district: "Ratnapura", province: "Sabaragamuwa Province" },
  "balangoda": { lat: 6.6500, lng: 80.7000, district: "Ratnapura", province: "Sabaragamuwa Province" },
  "embilipitiya": { lat: 6.3431, lng: 80.8506, district: "Ratnapura", province: "Sabaragamuwa Province" },
  "pelmadulla": { lat: 6.6167, lng: 80.5333, district: "Ratnapura", province: "Sabaragamuwa Province" },

  // Kegalle District
  "kegalle": { lat: 7.2523, lng: 80.3436, district: "Kegalle", province: "Sabaragamuwa Province" },
  "mawanella": { lat: 7.2500, lng: 80.4500, district: "Kegalle", province: "Sabaragamuwa Province" },
  "warakapola": { lat: 7.2167, lng: 80.2000, district: "Kegalle", province: "Sabaragamuwa Province" },
  "rambukkana": { lat: 7.3167, lng: 80.4000, district: "Kegalle", province: "Sabaragamuwa Province" },

  // Generic Province Centers
  "western province": { lat: 6.9271, lng: 79.8612, district: "Colombo", province: "Western Province" },
  "central province": { lat: 7.2906, lng: 80.6337, district: "Kandy", province: "Central Province" },
  "southern province": { lat: 6.0535, lng: 80.2210, district: "Galle", province: "Southern Province" },
  "northern province": { lat: 9.6615, lng: 80.0255, district: "Jaffna", province: "Northern Province" },
  "eastern province": { lat: 7.7310, lng: 81.6747, district: "Batticaloa", province: "Eastern Province" },
  "north western province": { lat: 7.4863, lng: 80.3623, district: "Kurunegala", province: "North Western Province" },
  "north central province": { lat: 8.3114, lng: 80.4037, district: "Anuradhapura", province: "North Central Province" },
  "uva province": { lat: 6.9934, lng: 81.0550, district: "Badulla", province: "Uva Province" },
  "sabaragamuwa province": { lat: 6.6828, lng: 80.4017, district: "Ratnapura", province: "Sabaragamuwa Province" },
};

/**
 * Parse Sri Lankan address and find matching coordinates
 * @param {string} address - The address string (e.g., "Wellawatte, Colombo 7")
 * @returns {object} - { lat, lng, matched, confidence }
 */
export const parseSriLankanAddress = (address) => {
  if (!address || typeof address !== 'string') {
    return {
      lat: 6.9271,
      lng: 79.8612,
      matched: false,
      confidence: 0,
      matchedLocation: 'Colombo (Default)'
    };
  }

  const addressLower = address.toLowerCase().trim();

  // Direct exact match
  if (sriLankaLocations[addressLower]) {
    return {
      ...sriLankaLocations[addressLower],
      matched: true,
      confidence: 100,
      matchedLocation: address
    };
  }

  // Try to find any matching location in the address string
  let bestMatch = null;
  let bestMatchLength = 0;

  for (const [locationName, coords] of Object.entries(sriLankaLocations)) {
    if (addressLower.includes(locationName)) {
      // Prefer longer matches (more specific)
      if (locationName.length > bestMatchLength) {
        bestMatch = {
          ...coords,
          matched: true,
          confidence: 90,
          matchedLocation: locationName
        };
        bestMatchLength = locationName.length;
      }
    }
  }

  if (bestMatch) {
    return bestMatch;
  }

  // Try splitting by comma and matching parts
  const parts = addressLower.split(',').map(p => p.trim());
  for (const part of parts) {
    if (sriLankaLocations[part]) {
      return {
        ...sriLankaLocations[part],
        matched: true,
        confidence: 80,
        matchedLocation: part
      };
    }
  }

  // Fuzzy matching - check if any location name is contained in any part
  for (const part of parts) {
    for (const [locationName, coords] of Object.entries(sriLankaLocations)) {
      if (part.includes(locationName) || locationName.includes(part)) {
        return {
          ...coords,
          matched: true,
          confidence: 70,
          matchedLocation: locationName
        };
      }
    }
  }

  // No match found - return Colombo as default
  return {
    lat: 6.9271,
    lng: 79.8612,
    matched: false,
    confidence: 0,
    matchedLocation: 'Colombo (Default)',
    district: "Colombo",
    province: "Western Province"
  };
};

/**
 * Get all unique districts
 */
export const getDistricts = () => {
  const districts = new Set();
  Object.values(sriLankaLocations).forEach(loc => {
    if (loc.district) districts.add(loc.district);
  });
  return Array.from(districts).sort();
};

/**
 * Get all unique provinces
 */
export const getProvinces = () => {
  const provinces = new Set();
  Object.values(sriLankaLocations).forEach(loc => {
    if (loc.province) provinces.add(loc.province);
  });
  return Array.from(provinces).sort();
};

/**
 * Get locations by district
 */
export const getLocationsByDistrict = (district) => {
  return Object.entries(sriLankaLocations)
    .filter(([_, coords]) => coords.district === district)
    .map(([name, coords]) => ({ name, ...coords }));
};

/**
 * Get locations by province
 */
export const getLocationsByProvince = (province) => {
  return Object.entries(sriLankaLocations)
    .filter(([_, coords]) => coords.province === province)
    .map(([name, coords]) => ({ name, ...coords }));
};

export default {
  sriLankaLocations,
  parseSriLankanAddress,
  getDistricts,
  getProvinces,
  getLocationsByDistrict,
  getLocationsByProvince,
};
